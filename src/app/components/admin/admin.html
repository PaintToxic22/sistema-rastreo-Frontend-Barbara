<div class="container-fluid">
  <div class="row">
    <!-- SIDEBAR -->
    <div class="col-md-3 col-lg-2 px-0">
      <div class="sidebar p-3">
        <div class="d-flex align-items-center mb-4">
          <div class="logo-admin">
            <i class="fas fa-truck text-primary"></i>
          </div>
          <div>
            <h5 class="text-white mb-0">LonquiExpress</h5>
            <small class="text-white-50">Panel Admin</small>
          </div>
        </div>

        <nav class="nav flex-column">
          <a class="nav-link" [ngClass]="{'active': seccion === 'dashboard'}" (click)="mostrarSeccion('dashboard')">
            <i class="fas fa-tachometer-alt me-2"></i>Dashboard
          </a>
          <a class="nav-link" [ngClass]="{'active': seccion === 'encomiendas'}" (click)="mostrarSeccion('encomiendas')">
            <i class="fas fa-box me-2"></i>Encomiendas
          </a>
          <a class="nav-link" [ngClass]="{'active': seccion === 'registro'}" (click)="mostrarSeccion('registro')">
            <i class="fas fa-plus-circle me-2"></i>Nueva Encomienda
          </a>
          <a class="nav-link" [ngClass]="{'active': seccion === 'seguimiento'}" (click)="mostrarSeccion('seguimiento')">
            <i class="fas fa-route me-2"></i>Seguimiento
          </a>
          <a class="nav-link" [ngClass]="{'active': seccion === 'orden-flete'}" (click)="mostrarSeccion('orden-flete')">
            <i class="fas fa-receipt me-2"></i>Órdenes de Flete
          </a>
          <a class="nav-link" [ngClass]="{'active': seccion === 'reportes'}" (click)="mostrarSeccion('reportes')">
            <i class="fas fa-chart-bar me-2"></i>Reportes
          </a>
          <a class="nav-link" [ngClass]="{'active': seccion === 'usuarios'}" (click)="mostrarSeccion('usuarios')">
            <i class="fas fa-users me-2"></i>Usuarios
          </a>
          <a class="nav-link" [ngClass]="{'active': seccion === 'personalizacion'}" (click)="mostrarSeccion('personalizacion')">
            <i class="fas fa-palette me-2"></i>Personalización
          </a>
          <a class="nav-link" [ngClass]="{'active': seccion === 'configuracion'}" (click)="mostrarSeccion('configuracion')">
            <i class="fas fa-cog me-2"></i>Configuración
          </a>
          <hr class="my-3">
          <a class="nav-link" (click)="logout()">
            <i class="fas fa-sign-out-alt me-2"></i>Salir
          </a>
        </nav>
      </div>
    </div>

    <!-- CONTENIDO PRINCIPAL -->
    <div class="col-md-9 col-lg-10">
      <div class="main-content">
        <!-- HEADER -->
        <div class="d-flex justify-content-between align-items-center mb-4">
          <div>
            <h2>Panel Administrativo</h2>
            <p class="text-muted mb-0">Gestión completa del sistema LonquiExpress</p>
          </div>
          <span class="badge bg-success fs-6">
            <i class="fas fa-circle me-1"></i>Sistema Activo
          </span>
        </div>

        <!-- ===== DASHBOARD ===== -->
        <div *ngIf="seccion === 'dashboard'">
          <div class="row mb-4">
            <div class="col-md-3 mb-3">
              <div class="card stat-card">
                <div class="card-body text-center">
                  <i class="fas fa-box fa-2x mb-2"></i>
                  <h3>{{ estadisticas.activas }}</h3>
                  <p class="mb-0">Encomiendas Activas</p>
                </div>
              </div>
            </div>
            <div class="col-md-3 mb-3">
              <div class="card stat-card-2">
                <div class="card-body text-center">
                  <i class="fas fa-shipping-fast fa-2x mb-2"></i>
                  <h3>{{ estadisticas.transito }}</h3>
                  <p class="mb-0">En Tránsito</p>
                </div>
              </div>
            </div>
            <div class="col-md-3 mb-3">
              <div class="card stat-card-3">
                <div class="card-body text-center">
                  <i class="fas fa-exclamation-triangle fa-2x mb-2"></i>
                  <h3>{{ estadisticas.incidencias }}</h3>
                  <p class="mb-0">Incidencias</p>
                </div>
              </div>
            </div>
            <div class="col-md-3 mb-3">
              <div class="card stat-card-4">
                <div class="card-body text-center">
                  <i class="fas fa-check-circle fa-2x mb-2"></i>
                  <h3>{{ estadisticas.entregadas }}</h3>
                  <p class="mb-0">Entregadas</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Acciones rápidas -->
          <div class="row mb-4">
            <div class="col-12"><h4>Acciones Rápidas</h4></div>
            <div class="col-md-4 mb-3">
              <div class="card quick-action" (click)="mostrarSeccion('registro')" style="cursor: pointer;">
                <div class="card-body text-center">
                  <i class="fas fa-plus fa-2x text-primary mb-2"></i>
                  <h5>Nueva Encomienda</h5>
                  <p class="text-muted">Registrar nueva</p>
                </div>
              </div>
            </div>
            <div class="col-md-4 mb-3">
              <div class="card quick-action" (click)="mostrarSeccion('seguimiento')" style="cursor: pointer;">
                <div class="card-body text-center">
                  <i class="fas fa-search fa-2x text-success mb-2"></i>
                  <h5>Buscar Encomienda</h5>
                  <p class="text-muted">Consultar estado</p>
                </div>
              </div>
            </div>
            <div class="col-md-4 mb-3">
              <div class="card quick-action" (click)="mostrarSeccion('reportes')" style="cursor: pointer;">
                <div class="card-body text-center">
                  <i class="fas fa-download fa-2x text-info mb-2"></i>
                  <h5>Generar Reporte</h5>
                  <p class="text-muted">Exportar datos</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Ingresos -->
          <div class="row">
            <div class="col-12">
              <div class="card">
                <div class="card-header">
                  <h5><i class="fas fa-dollar-sign me-2"></i>Ingresos Totales</h5>
                </div>
                <div class="card-body">
                  <h3 class="text-success">${{ estadisticas.ingresos | number: '1.0-0' }}</h3>
                  <p class="text-muted">Valor total de encomiendas</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ===== ENCOMIENDAS ===== -->
        <div *ngIf="seccion === 'encomiendas'">
          <div class="card">
            <div class="card-header">
              <h5><i class="fas fa-box me-2"></i>Gestión de Encomiendas</h5>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead class="table-light">
                    <tr>
                      <th>Código</th>
                      <th>Remitente</th>
                      <th>Destinatario</th>
                      <th>Valor</th>
                      <th>Estado</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let e of encomiendas">
                      <td><strong>{{ e.codigoSeguimiento }}</strong></td>
                      <td>{{ e.remitente.nombre }}</td>
                      <td>{{ e.destinatario.nombre }}</td>
                      <td>${{ e.valor | number: '1.0-0' }}</td>
                      <td>
                        <span class="badge" [ngClass]="getEstadoBadge(e.estado)">
                          {{ getEstadoTexto(e.estado) }}
                        </span>
                      </td>
                      <td>
                        <select class="form-select form-select-sm" (change)="actualizarEstadoEncomienda(e, $any($event.target).value)">
                          <option value="">Cambiar estado</option>
                          <option value="pendiente">Pendiente</option>
                          <option value="en_transito">En Tránsito</option>
                          <option value="entregada">Entregada</option>
                          <option value="incidencia">Incidencia</option>
                          <option value="cancelada">Cancelada</option>
                        </select>
                        <button class="btn btn-sm btn-danger mt-1" (click)="eliminarEncomienda(e)">
                          <i class="fas fa-trash"></i>
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- ===== REGISTRO ===== -->
        <div *ngIf="seccion === 'registro'">
          <div class="card">
            <div class="card-header">
              <h5><i class="fas fa-plus-circle me-2"></i>Registrar Nueva Encomienda</h5>
            </div>
            <div class="card-body">
              <form (ngSubmit)="registrarEncomienda()">
                <div class="row">
                  <div class="col-md-6">
                    <h6>Datos del Remitente</h6>
                    <div class="mb-3">
                      <label class="form-label">Nombre *</label>
                      <input type="text" class="form-control" [(ngModel)]="formNuevaEncomienda.remitente.nombre" name="remitente_nombre" required>
                    </div>
                    <div class="mb-3">
                      <label class="form-label">Email</label>
                      <input type="email" class="form-control" [(ngModel)]="formNuevaEncomienda.remitente.email" name="remitente_email">
                    </div>
                    <div class="mb-3">
                      <label class="form-label">Teléfono</label>
                      <input type="tel" class="form-control" [(ngModel)]="formNuevaEncomienda.remitente.telefono" name="remitente_telefono">
                    </div>
                  </div>

                  <div class="col-md-6">
                    <h6>Datos del Destinatario</h6>
                    <div class="mb-3">
                      <label class="form-label">Nombre *</label>
                      <input type="text" class="form-control" [(ngModel)]="formNuevaEncomienda.destinatario.nombre" name="destinatario_nombre" required>
                    </div>
                    <div class="mb-3">
                      <label class="form-label">Email</label>
                      <input type="email" class="form-control" [(ngModel)]="formNuevaEncomienda.destinatario.email" name="destinatario_email">
                    </div>
                    <div class="mb-3">
                      <label class="form-label">Teléfono</label>
                      <input type="tel" class="form-control" [(ngModel)]="formNuevaEncomienda.destinatario.telefono" name="destinatario_telefono">
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-6">
                    <div class="mb-3">
                      <label class="form-label">Descripción</label>
                      <textarea class="form-control" [(ngModel)]="formNuevaEncomienda.descripcion" name="descripcion" rows="3"></textarea>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="mb-3">
                      <label class="form-label">Valor (CLP) *</label>
                      <input type="number" class="form-control" [(ngModel)]="formNuevaEncomienda.valor" name="valor" required min="0">
                    </div>
                  </div>
                </div>

                <button type="submit" class="btn btn-primary"><i class="fas fa-save me-2"></i>Registrar Encomienda</button>
                <button type="button" class="btn btn-secondary" (click)="mostrarSeccion('encomiendas')">Cancelar</button>
              </form>
            </div>
          </div>
        </div>

        <!-- ===== SEGUIMIENTO ===== -->
        <div *ngIf="seccion === 'seguimiento'">
          <div class="card">
            <div class="card-header">
              <h5><i class="fas fa-route me-2"></i>Seguimiento en Vivo</h5>
            </div>
            <div class="card-body">
              <div class="row mb-3">
                <div class="col-md-9">
                  <input type="text" class="form-control" placeholder="Ingresa código de seguimiento..." [(ngModel)]="formBusqueda.codigo" name="codigo">
                </div>
                <div class="col-md-3">
                  <button class="btn btn-primary w-100" (click)="buscarEncomienda()">
                    <i class="fas fa-search me-2"></i>Buscar
                  </button>
                </div>
              </div>

              <div *ngIf="mostrarResultadosBusqueda && encomiendasBuscadas.length > 0" class="table-responsive">
                <table class="table table-hover">
                  <thead class="table-light">
                    <tr>
                      <th>Código</th>
                      <th>Remitente</th>
                      <th>Destinatario</th>
                      <th>Valor</th>
                      <th>Estado</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let e of encomiendasBuscadas">
                      <td><strong>{{ e.codigoSeguimiento }}</strong></td>
                      <td>{{ e.remitente.nombre }}</td>
                      <td>{{ e.destinatario.nombre }}</td>
                      <td>${{ e.valor | number: '1.0-0' }}</td>
                      <td>
                        <span class="badge" [ngClass]="getEstadoBadge(e.estado)">
                          {{ getEstadoTexto(e.estado) }}
                        </span>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- ===== ÓRDENES DE FLETE ===== -->
        <div *ngIf="seccion === 'orden-flete'">
          <div class="card">
            <div class="card-header">
              <h5><i class="fas fa-receipt me-2"></i>Órdenes de Flete</h5>
            </div>
            <div class="card-body">
              <h6>Crear Nueva Orden</h6>
              <div class="row mb-3">
                <div class="col-md-4">
                  <label class="form-label">Chofer</label>
                  <input type="text" class="form-control" [(ngModel)]="formOrden.chofer" name="chofer" placeholder="Nombre del chofer">
                </div>
                <div class="col-md-4">
                  <label class="form-label">Vehículo</label>
                  <input type="text" class="form-control" [(ngModel)]="formOrden.vehiculo" name="vehiculo" placeholder="Marca y modelo">
                </div>
                <div class="col-md-4">
                  <label class="form-label">Encomiendas</label>
                  <input type="text" class="form-control" [(ngModel)]="formOrden.encomiendas" name="encomiendas" placeholder="Códigos separados por coma">
                </div>
              </div>
              <button class="btn btn-primary" (click)="crearOrden()">
                <i class="fas fa-plus me-2"></i>Crear Orden
              </button>

              <div *ngIf="ordenesCreadas.length > 0" class="mt-4">
                <h6>Órdenes Creadas</h6>
                <div class="table-responsive">
                  <table class="table">
                    <thead>
                      <tr>
                        <th>Número</th>
                        <th>Chofer</th>
                        <th>Vehículo</th>
                        <th>Encomiendas</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let orden of ordenesCreadas">
                        <td>{{ orden.numeroOrden }}</td>
                        <td>{{ orden.chofer }}</td>
                        <td>{{ orden.vehiculo }}</td>
                        <td>{{ orden.encomiendas.length }}</td>
                        <td><span class="badge bg-info">{{ orden.estado }}</span></td>
                        <td>
                          <button class="btn btn-sm btn-danger" (click)="eliminarOrden(orden)">
                            <i class="fas fa-trash"></i>
                          </button>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ===== REPORTES ===== -->
        <div *ngIf="seccion === 'reportes'">
          <div class="card">
            <div class="card-header">
              <h5><i class="fas fa-chart-bar me-2"></i>Reportes y Estadísticas</h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-6">
                  <h6>Resumen General</h6>
                  <ul class="list-unstyled">
                    <li><strong>Total de Encomiendas:</strong> {{ estadisticas.activas }}</li>
                    <li><strong>En Tránsito:</strong> {{ estadisticas.transito }}</li>
                    <li><strong>Entregadas:</strong> {{ estadisticas.entregadas }}</li>
                    <li><strong>Incidencias:</strong> {{ estadisticas.incidencias }}</li>
                    <li><strong>Ingresos:</strong> ${{ estadisticas.ingresos | number: '1.0-0' }}</li>
                  </ul>
                </div>
                <div class="col-md-6">
                  <h6>Opciones de Exportación</h6>
                  <div class="btn-group" role="group">
                    <button type="button" class="btn btn-outline-primary" (click)="exportarCSV()">
                      <i class="fas fa-file-csv me-1"></i>CSV ✅
                    </button>
                    <button type="button" class="btn btn-outline-danger" (click)="exportarPDF()">
                      <i class="fas fa-file-pdf me-1"></i>PDF
                    </button>
                    <button type="button" class="btn btn-outline-success" (click)="exportarExcel()">
                      <i class="fas fa-file-excel me-1"></i>Excel
                    </button>
                  </div>
                  <button type="button" class="btn btn-info mt-2" (click)="generarReporte()">
                    <i class="fas fa-print me-1"></i>Ver Reporte
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ===== USUARIOS ===== -->
        <div *ngIf="seccion === 'usuarios'">
          <div class="card">
            <div class="card-header">
              <h5><i class="fas fa-users me-2"></i>Gestión de Usuarios</h5>
            </div>
            <div class="card-body">
              <h6>Crear Nuevo Usuario</h6>
              <div class="row mb-3">
                <div class="col-md-3">
                  <input type="text" class="form-control" [(ngModel)]="formNuevoUsuario.nombre" name="nombre" placeholder="Nombre">
                </div>
                <div class="col-md-3">
                  <input type="email" class="form-control" [(ngModel)]="formNuevoUsuario.email" name="email" placeholder="Email">
                </div>
                <div class="col-md-2">
                  <select class="form-select" [(ngModel)]="formNuevoUsuario.rol" name="rol">
                    <option value="operador">Operador</option>
                    <option value="chofer">Chofer</option>
                    <option value="usuario">Usuario</option>
                  </select>
                </div>
                <div class="col-md-2">
                  <input type="password" class="form-control" [(ngModel)]="formNuevoUsuario.password" name="password" placeholder="Contraseña">
                </div>
                <div class="col-md-2">
                  <button class="btn btn-primary w-100" (click)="crearNuevoUsuario()">
                    <i class="fas fa-plus"></i>
                  </button>
                </div>
              </div>

              <h6 class="mt-4">Usuarios del Sistema</h6>
              <div class="table-responsive">
                <table class="table">
                  <thead>
                    <tr>
                      <th>Nombre</th>
                      <th>Email</th>
                      <th>Rol</th>
                      <th>Estado</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let u of usuarios">
                      <td>{{ u.nombre }}</td>
                      <td>{{ u.email }}</td>
                      <td>
                        <span class="badge bg-info">{{ u.rol }}</span>
                      </td>
                      <td>
                        <span class="badge" [ngClass]="getEstadoBadge(u.estado)">
                          {{ getEstadoTexto(u.estado) }}
                        </span>
                      </td>
                      <td>
                        <button class="btn btn-sm btn-warning" (click)="cambiarEstadoUsuario(u)">
                          <i class="fas fa-toggle-on"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" (click)="eliminarUsuario(u)">
                          <i class="fas fa-trash"></i>
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- ===== PERSONALIZACIÓN ===== -->
        <div *ngIf="seccion === 'personalizacion'">
          <div class="card">
            <div class="card-header">
              <h5><i class="fas fa-palette me-2"></i>Personalización del Sistema</h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-6">
                  <h6>Tema Visual</h6>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="theme" id="theme-light" [checked]="tema === 'light'" (change)="cambiarTema('light')">
                    <label class="form-check-label" for="theme-light">
                      <i class="fas fa-sun me-2"></i>Claro
                    </label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="theme" id="theme-dark" [checked]="tema === 'dark'" (change)="cambiarTema('dark')">
                    <label class="form-check-label" for="theme-dark">
                      <i class="fas fa-moon me-2"></i>Oscuro
                    </label>
                  </div>
                </div>
                <div class="col-md-6">
                  <h6>Configuración Regional</h6>
                  <select class="form-select" [(ngModel)]="idioma" name="idioma" (change)="cambiarIdioma(idioma)">
                    <option value="es">Español</option>
                    <option value="en">Inglés</option>
                    <option value="pt">Portugués</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ===== CONFIGURACIÓN ===== -->
        <div *ngIf="seccion === 'configuracion'">
          <div class="card">
            <div class="card-header">
              <h5><i class="fas fa-cog me-2"></i>Configuración del Sistema</h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-6">
                  <h6>Información de la Empresa</h6>
                  <div class="mb-3">
                    <label class="form-label">Nombre</label>
                    <input type="text" class="form-control" [(ngModel)]="empresaConfig.nombre" name="empresa_nombre">
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-control" [(ngModel)]="empresaConfig.email" name="empresa_email">
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Teléfono</label>
                    <input type="tel" class="form-control" [(ngModel)]="empresaConfig.telefono" name="empresa_telefono">
                  </div>
                  <button class="btn btn-success" (click)="guardarConfigEmpresa()">
                    <i class="fas fa-save me-2"></i>Guardar Configuración
                  </button>
                </div>
                <div class="col-md-6">
                  <h6>Información del Sistema</h6>
                  <ul class="list-unstyled">
                    <li><strong>Versión:</strong> 1.0.0</li>
                    <li><strong>Estado:</strong> <span class="badge bg-success">Activo</span></li>
                    <li><strong>Base de Datos:</strong> MongoDB</li>
                    <li><strong>Framework:</strong> Angular 20</li>
                    <li><strong>Última Actualización:</strong> Hoy</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>